# .github/workflows/export-tokens-on-input.yml
name: Generate Tokens On Input from Figma

on:
  push:
    paths:  
      - 'input/design-tokens.json'

jobs:
  generate_tokens:
    runs-on: macos-latest
    
    steps:
    
    # this lets us work in the actual repository 
    - uses: actions/checkout@master
    # if the folder named "input" does not exist, create it
    - name: mkdir "input" directory
      # change tokens here (and in line 32) if you want to use a differently named folder 
      run: 'mkdir -p tokens'
    # this creates a json file from the stringified json from the request body
    - name: create json from request body
      id: create-json
      uses: jsdaniell/create-json@1.1.2
      with:
        # it uses the name from your settings that was send as then tokenFileName parameter
        name: 'design-tokens.json'
        # it uses the json string that was send as the tokens parameter
        json: ${{ github.event.client_payload.tokens }}
        # it uses the directory named "input" to store this json file (change this if you changed it above to use a different folder)
        dir: 'input'
        
    # we now initialize node to run amazon style dictionary to compile the tokens
    - uses: actions/checkout@v2
    - name: Use Node.js 14.x
      uses: actions/setup-node@v2
      with:
          # we use version 14.x of node
          node-version: '12'

    - name: Install Node Dependencies
      run: npm install
    - name: Build Style Dictionary
      run: npm run build
    - name: Update SCSS
      run: npm run build-css
    - name: Commit Generated Platform Deliverables
      id: "auto-commit-action"
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: Update platform deliverables


